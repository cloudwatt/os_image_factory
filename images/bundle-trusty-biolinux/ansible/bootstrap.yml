---
#
##
### Written by the CAT (Cloudwatt Automation Team)
##
#
- hosts: all
  become: yes

  tasks:

#    - name: template config.dat
#      template: src=config.dat  dest=/var/cache/debconf/config.dat
#    - name:
#      shell: sed "14cma Name: arb/group "

#    - name:
#      shell: sed -i "14cma \\Name: arb\/group\\Template: arb\/group\\Value:\\Owners: arb-common\\Flags: seen\\Variables:\\  users = cloud (Cloud user)" /var/cache/debconf/config.dat

#    - name:
#      lineinfile:
#          dest=/var/cache/debconf/config.dat
#          regexp='^cloudwatt'
#          line='
#               Name: arb/group\nTemplate: arb/group\nValue:\nOwners: arb-common\n  Flags: seen\nVariables:\n  users = cloud (Cloud user)'

  #  - name: insert /var/cache/debconf/config.dat
  #    blockinfile:
  #      dest: /var/cache/debconf/config.dat
  #      block: |
  #        Name: arb/group
  #        Template: arb/group
  #        Value:
  #        Owners: arb-common
  #        Flags: seen
  #        Variables:
  #            users = cloud (Cloud user)
    - name: install apt-get install apt-utils
      apt: name=apt-utils state=present

    - name: Non-Interactive
      shell: export DEBIAN_FRONTEND=noninteractive

    - name: template config.dat
      template: src=config.dat  dest=/var/cache/debconf/config.dat

    - name: copy upgrade_to_8
      copy: src=upgrade8.sh dest=/root/

#    - name: execute upgrade8.sh
#      shell: sudo -i && sh upgrade8.sh

    - name: execute script
      script: upgrade8.sh --some-arguments 1234
